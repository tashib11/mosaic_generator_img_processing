<!DOCTYPE html>
<html>
<head>
    <title>Mosaic Generator</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css">
    <style>
        .loader { display: none; position: fixed; top: 50%; left: 50%; 
                  border: 8px solid #f3f3f3; border-top: 8px solid #3498db; 
                  border-radius: 50%; width: 60px; height: 60px; animation: spin 1s linear infinite; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body>
<div class="container mt-5">
    <h1>Superpixel Mosaic Generator</h1>
    
    <form id="form" enctype="multipart/form-data">
        <div class="form-group">
            <label>Target Image:</label>
            <input type="file" name="target_image" class="form-control-file" required>
        </div>
        
        <div class="form-group">
            <label>Superpixels: <span id="segVal">80</span></label>
            <input type="range" name="n_segments" class="form-control-range" 
                   min="20" max="200" value="80" oninput="document.getElementById('segVal').textContent=this.value">
        </div>
        
        <div class="form-group">
            <label>Blending: <span id="alphaVal">0.4</span></label>
            <input type="range" name="alpha" class="form-control-range" 
                   min="0" max="1" step="0.1" value="0.4" oninput="document.getElementById('alphaVal').textContent=this.value">
            <small>0 = Original | 1 = Full Mosaic</small>
        </div>
        
        <button type="submit" class="btn btn-primary">Generate</button>
    </form>
    
    <div class="loader" id="loader"></div>
</div>

<script src="https://code.jquery.com/jquery-3.2.1.min.js"></script>
<script>
document.getElementById('form').onsubmit = function(e) {
    e.preventDefault();
    document.getElementById('loader').style.display = 'block';
    
    fetch('/', { method: 'POST', body: new FormData(this) })
        .then(r => r.json())
        .then(d => {
            document.getElementById('loader').style.display = 'none';
            window.location.href = `/output?n_segments=${d.n_segments}&alpha=${d.alpha}`;
        })
        .catch(err => {
            alert('Error: ' + err);
            document.getElementById('loader').style.display = 'none';
        });
};
</script>
</body>
</html>